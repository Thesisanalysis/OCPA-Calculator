<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PAU OCPA Calculator - Enhanced</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e8f5e9 0%, #f1f8e9 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .pau-ocpa-calculator {
            max-width: 1100px;
            margin: 20px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.12);
            overflow: hidden;
        }
        
        .pau-header {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
            position: relative;
            overflow: hidden;
        }
        
        .pau-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="white" opacity="0.1"/><circle cx="80" cy="40" r="1.5" fill="white" opacity="0.1"/><circle cx="40" cy="70" r="1" fill="white" opacity="0.1"/></svg>');
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .pau-header h2 {
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }
        
        .pau-header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .content-wrapper {
            padding: 40px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 0;
            margin-bottom: 30px;
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        .tab-btn {
            flex: 1;
            padding: 18px 25px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            border-right: 1px solid #e0e0e0;
            color: #555;
        }
        
        .tab-btn:last-child {
            border-right: none;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #2e7d32 0%, #388e3c 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);
        }
        
        .tab-btn:hover:not(.active) {
            background: #e8f5e9;
            transform: translateY(-1px);
        }
        
        .upload-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 50px;
            border: 3px dashed #adb5bd;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s ease;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }
        
        .upload-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(46, 125, 50, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .upload-section:hover {
            border-color: #2e7d32;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 125, 50, 0.15);
        }
        
        .upload-section:hover::before {
            left: 100%;
        }
        
        .upload-icon {
            font-size: 60px;
            margin-bottom: 20px;
            color: #2e7d32;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .upload-section h3 {
            color: #2e7d32;
            margin-bottom: 12px;
            font-size: 1.4em;
            font-weight: 600;
        }
        
        .section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2e7d32;
            font-size: 14px;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: #fafafa;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #2e7d32;
            background: white;
            box-shadow: 0 0 0 3px rgba(46, 125, 50, 0.1);
            transform: translateY(-1px);
        }
        
        .course-table {
            width: 100%;
            border-collapse: collapse;
            margin: 25px 0;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .course-table th {
            background: linear-gradient(135deg, #2e7d32 0%, #388e3c 100%);
            color: white;
            padding: 18px 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }
        
        .course-table td {
            padding: 15px 12px;
            border-bottom: 1px solid #f0f0f0;
            vertical-align: middle;
        }
        
        .course-table tr:last-child td {
            border-bottom: none;
        }
        
        .course-table tr:nth-child(even) {
            background: #fafafa;
        }
        
        .course-table tr:hover {
            background: #f5f5f5;
        }
        
        .course-table input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .course-table input:focus {
            border-color: #2e7d32;
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.1);
        }
        
        .btn {
            background: linear-gradient(135deg, #2e7d32 0%, #388e3c 100%);
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            margin: 6px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(46, 125, 50, 0.4);
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #d32f2f 0%, #f44336 100%);
        }
        
        .btn-danger:hover {
            box-shadow: 0 6px 20px rgba(211, 47, 47, 0.4);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid #2e7d32;
            color: #2e7d32;
        }
        
        .btn-outline:hover {
            background: #2e7d32;
            color: white;
        }
        
        .btn-blue {
            background: linear-gradient(135deg, #1976d2 0%, #2196f3 100%);
        }
        
        .btn-blue:hover {
            box-shadow: 0 6px 20px rgba(25, 118, 210, 0.4);
        }
        
        .add-row-btn {
            background: linear-gradient(135deg, #4caf50 0%, #66bb6a 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 15px 0;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .add-row-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(76, 175, 80, 0.4);
        }
        
        .summary-box {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #2e7d32;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .summary-box h3 {
            color: #1b5e20;
            margin-bottom: 18px;
            font-size: 1.3em;
        }
        
        .summary-box p {
            margin: 10px 0;
            font-size: 15px;
            color: #2e7d32;
        }
        
        .summary-box strong {
            color: #1b5e20;
            font-weight: 600;
        }
        
        .export-options {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin: 25px 0;
        }
        
        .success-message {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724;
            padding: 18px;
            border-radius: 8px;
            border: 1px solid #c3e6cb;
            margin: 18px 0;
            font-weight: 500;
        }
        
        .error-message {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24;
            padding: 18px;
            border-radius: 8px;
            border: 1px solid #f5c6cb;
            margin: 18px 0;
            font-weight: 500;
        }
        
        .loading {
            color: #1976d2;
            font-style: italic;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .loading::before {
            content: '';
            width: 20px;
            height: 20px;
            border: 2px solid #e3f2fd;
            border-top: 2px solid #1976d2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        input[type="file"] {
            display: none;
        }
        
        .prediction-summary {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid #1976d2;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .prediction-summary h4 {
            color: #1565c0;
            margin-bottom: 18px;
            font-size: 1.2em;
        }
        
        .ocpa-display {
            font-size: 2em;
            font-weight: 700;
            color: #2e7d32;
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 2px solid #e8f5e9;
        }

        .uploaded-image {
            max-width: 100%;
            height: auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .parsing-section {
            background: linear-gradient(135deg, #f0f4f8 0%, #e1f5fe 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #1976d2;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .parsing-section h4 {
            color: #1565c0;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .data-extraction {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
        }

        .manual-edit-section {
            background: #fff3e0;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #ff9800;
        }

        .manual-edit-section h4 {
            color: #e65100;
            margin-bottom: 15px;
        }

        .edit-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        /* Responsive design for mobile */
        @media (max-width: 768px) {
            .pau-ocpa-calculator {
                margin: 10px;
            }
            
            .content-wrapper {
                padding: 20px;
            }
            
            .pau-header h2 {
                font-size: 2em;
            }
            
            .tab-buttons {
                flex-direction: column;
            }
            
            .tab-btn {
                border-right: none;
                border-bottom: 1px solid #e0e0e0;
            }
            
            .tab-btn:last-child {
                border-bottom: none;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .course-table {
                font-size: 12px;
            }
            
            .course-table th,
            .course-table td {
                padding: 10px 6px;
            }
            
            .export-options {
                flex-direction: column;
            }
            
            .ocpa-display {
                font-size: 1.5em;
            }
            
            .edit-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="pau-ocpa-calculator">
        <div class="pau-header">
            <h2>🎓 PAU OCPA Calculator</h2>
            <p>Calculate and Predict your Overall Cumulative Performance Average</p>
        </div>
        
        <div class="content-wrapper">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('upload', this)">📄 Upload CP Sheet</button>
                <button class="tab-btn" onclick="switchTab('manual', this)">✏️ Manual Entry</button>
            </div>

            <!-- Upload Section -->
            <div id="upload-section" class="section active">
                <div class="upload-section" onclick="triggerFileUpload()">
                    <div class="upload-icon">📄</div>
                    <h3>Upload Your PAU Credit Point Sheet</h3>
                    <p>Supports JPG, PNG, PDF formats</p>
                    <input type="file" id="file-input" accept=".jpg,.jpeg,.png,.pdf" onchange="handleFileUpload(event)">
                </div>
                
                <button type="button" class="btn btn-outline" onclick="clearUploadData()" style="margin-top: 15px;">🗑️ Clear Upload & Start Fresh</button>
                
                <div id="upload-status"></div>
                <div id="image-preview"></div>
                <div id="parsing-section" style="display: none;"></div>
                <div id="manual-edit-section" style="display: none;"></div>
            </div>

            <!-- Manual Entry Section -->
            <div id="manual-section" class="section">
                <h3>📝 Enter Student Data Manually</h3>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="student-name">Student Name *</label>
                        <input type="text" id="student-name" placeholder="Enter full name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="admission-no">Admission Number *</label>
                        <input type="text" id="admission-no" placeholder="Enter admission number" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="semester">Current Semester *</label>
                        <input type="text" id="semester" placeholder="e.g., 17-18.1 (4)" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="performance">Overall Performance</label>
                        <select id="performance">
                            <option value="Outstanding">Outstanding</option>
                            <option value="Excellent">Excellent</option>
                            <option value="Very Good">Very Good</option>
                            <option value="Good" selected>Good</option>
                            <option value="Average">Average</option>
                            <option value="Poor">Poor</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="total-cr-hrs">Total Cr. Hrs</label>
                        <input type="number" id="total-cr-hrs" placeholder="Total credit hours" min="0" step="0.5" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="priv-cr-hrs">Priv. Cr.Hrs.</label>
                        <input type="number" id="priv-cr-hrs" placeholder="Previous credit hours" min="0" step="0.5" value="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="prey-cr-hrs">Prey. Cr. Hr</label>
                        <input type="number" id="prey-cr-hrs" placeholder="Previous semester credit hours" min="0" step="0.5" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="less-cr-hrs">Less Cr. Hr</label>
                        <input type="number" id="less-cr-hrs" placeholder="Less credit hours" min="0" step="0.5" value="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="cumu-cr-hrs">Cumu. Cr. Hrs.</label>
                        <input type="number" id="cumu-cr-hrs" placeholder="Cumulative credit hours" min="0" step="0.5" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="total-cr-pts">Total Cr. Pts.</label>
                        <input type="number" id="total-cr-pts" placeholder="Total credit points" min="0" step="0.01" value="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="priv-cr-pts">Priv. Cr.Pts.</label>
                        <input type="number" id="priv-cr-pts" placeholder="Previous credit points" min="0" step="0.01" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="prey-cr-pts">Prey. Cr. Pts.</label>
                        <input type="number" id="prey-cr-pts" placeholder="Previous semester credit points" min="0" step="0.01" value="0">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="less-cr-pts">Less Cr. Pts.</label>
                        <input type="number" id="less-cr-pts" placeholder="Less credit points" min="0" step="0.01" value="0">
                    </div>
                    
                    <div class="form-group">
                        <label for="cumu-cr-pts">Cumu. Cr. Pts.</label>
                        <input type="number" id="cumu-cr-pts" placeholder="Cumulative credit points" min="0" step="0.01" value="0">
                    </div>
                </div>

                <h4>📚 Current Semester Courses</h4>
                <table class="course-table" id="courses-table">
                    <thead>
                        <tr>
                            <th>Sr</th>
                            <th>Course Code</th>
                            <th>Course Title</th>
                            <th>Credit Hours</th>
                            <th>Credit Points</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="courses-body">
                        <tr>
                            <td>1</td>
                            <td><input type="text" class="course-code" placeholder="EXT-571"></td>
                            <td><input type="text" class="course-title" placeholder="Course Title"></td>
                            <td><input type="number" class="course-credits" min="0.5" max="20" step="0.5" value="3" onchange="calculateFromCreditPoints()"></td>
                            <td><input type="number" class="course-cp" min="0" step="0.01" value="24.0" onchange="calculateFromCreditPoints()"></td>
                            <td><button type="button" class="btn btn-danger" onclick="removeCourse(this)">Remove</button></td>
                        </tr>
                    </tbody>
                </table>
                
                <button type="button" class="add-row-btn" onclick="addCourse()">➕ Add Course</button>
                
                <div style="margin-top: 30px;">
                    <button type="button" class="btn" onclick="calculateOCPA()">🧮 Calculate OCPA</button>
                    <button type="button" class="btn btn-outline" onclick="clearData()">🗑️ Clear All</button>
                </div>
                
                <div id="manual-status"></div>
            </div>

            <!-- Results Section -->
            <div id="results-section" style="display: none;">
                <div class="summary-box">
                    <h3>📊 Student Information</h3>
                    <p><strong>Name:</strong> <span id="display-name">-</span></p>
                    <p><strong>Admission No:</strong> <span id="display-admission">-</span></p>
                    <p><strong>Semester:</strong> <span id="display-semester">-</span></p>
                    <p><strong>Overall Performance:</strong> <span id="display-performance">-</span></p>
                </div>

                <h4>📋 Course Details</h4>
                <div id="results-table"></div>

                <div class="summary-box">
                    <h3>📈 Academic Summary</h3>
                    <div class="form-row">
                        <div>
                            <p><strong>Total Cr. Hrs:</strong> <span id="display-total-cr-hrs">0</span></p>
                            <p><strong>Priv. Cr.Hrs.:</strong> <span id="display-priv-cr-hrs">0</span></p>
                            <p><strong>Prey. Cr. Hr:</strong> <span id="display-prey-cr-hrs">0</span></p>
                            <p><strong>Less Cr. Hr:</strong> <span id="display-less-cr-hrs">0</span></p>
                            <p><strong>Cumu. Cr. Hrs.:</strong> <span id="display-cumu-cr-hrs">0</span></p>
                        </div>
                        <div>
                            <p><strong>Total Cr. Pts.:</strong> <span id="display-total-cr-pts">0.00</span></p>
                            <p><strong>Priv. Cr.Pts.:</strong> <span id="display-priv-cr-pts">0.00</span></p>
                            <p><strong>Prey. Cr. Pts.:</strong> <span id="display-prey-cr-pts">0.00</span></p>
                            <p><strong>Less Cr. Pts.:</strong> <span id="display-less-cr-pts">0.00</span></p>
                            <p><strong>Cumu. Cr. Pts.:</strong> <span id="display-cumu-cr-pts">0.00</span></p>
                        </div>
                    </div>
                    <div class="form-row">
                        <p><strong>CPA:</strong> <span id="display-cpa">0.00</span></p>
                        <div class="ocpa-display">
                            OCPA: <span id="final-ocpa">0.00</span>
                        </div>
                    </div>
                </div>

                <div class="export-options">
                    <button class="btn btn-blue" onclick="exportToHTML()">📄 Export Report</button>
                    <button class="btn btn-blue" onclick="exportToCSV()">📊 Export CSV</button>
                    <button class="btn" onclick="showPrediction()">🔮 Predict Future OCPA</button>
                </div>
            </div>

            <!-- Prediction Section -->
            <div id="prediction-section" style="display: none;">
                <h3>🔮 OCPA Prediction</h3>
                <p>Enter expected marks (%) for upcoming semester courses:</p>

                <table class="course-table" id="prediction-table">
                    <thead>
                        <tr>
                            <th>Course Code</th>
                            <th>Course Title</th>
                            <th>Credit Hours</th>
                            <th>Expected Marks (%)</th>
                            <th>Projected CP</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="prediction-body">
                        <tr>
                            <td><input type="text" placeholder="EXT-671"></td>
                            <td><input type="text" placeholder="Advanced Course"></td>
                            <td><input type="number" class="pred-credits" min="0.5" max="20" step="0.5" value="3" onchange="calculatePrediction()"></td>
                            <td><input type="number" class="pred-marks" min="0" max="100" value="80" onchange="calculatePrediction()"></td>
                            <td class="pred-cp">24.0</td>
                            <td><button type="button" class="btn btn-danger" onclick="removePrediction(this)">Remove</button></td>
                        </tr>
                    </tbody>
                </table>

                <button type="button" class="add-row-btn" onclick="addPrediction()">➕ Add Course</button>

                <div class="prediction-summary">
                    <h4>🎯 Prediction Results</h4>
                    <p><strong>Current OCPA:</strong> <span id="pred-current-ocpa">0.00</span></p>
                    <p><strong>New Semester Credit Hours:</strong> <span id="pred-new-credits">0</span></p>
                    <p><strong>New Semester Credit Points:</strong> <span id="pred-new-cp">0.00</span></p>
                    <p><strong>New Semester CPA:</strong> <span id="pred-new-cpa">0.00</span></p>
                    <div class="ocpa-display">
                        Projected OCPA: <span id="projected-ocpa">0.00</span>
                    </div>
                </div>

                <button type="button" class="btn" onclick="calculatePrediction()">🧮 Recalculate</button>
                <button type="button" class="btn btn-outline" onclick="backToResults()">← Back to Results</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables - Enhanced data structure
        var studentData = {
            name: '',
            admissionNo: '',
            semester: '',
            performance: 'Good',
            courses: [],
            
            // All credit hour fields
            totalCrHrs: 0,
            privCrHrs: 0,
            preyCrHrs: 0,
            lessCrHrs: 0,
            cumuCrHrs: 0,
            
            // All credit point fields
            totalCrPts: 0,
            privCrPts: 0,
            preyCrPts: 0,
            lessCrPts: 0,
            cumuCrPts: 0,
            
            // Calculated values
            cpa: 0,
            ocpa: 0
        };

        var uploadedFile = null;
        var isDataFromUpload = false;

        // Clear upload data completely
        function clearUploadData() {
            document.getElementById('file-input').value = '';
            document.getElementById('upload-status').innerHTML = '';
            document.getElementById('image-preview').innerHTML = '';
            document.getElementById('parsing-section').style.display = 'none';
            document.getElementById('manual-edit-section').style.display = 'none';
            
            // Reset student data
            studentData = {
                name: '', admissionNo: '', semester: '', performance: 'Good', courses: [],
                totalCrHrs: 0, privCrHrs: 0, preyCrHrs: 0, lessCrHrs: 0, cumuCrHrs: 0,
                totalCrPts: 0, privCrPts: 0, preyCrPts: 0, lessCrPts: 0, cumuCrPts: 0,
                cpa: 0, ocpa: 0
            };
            
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('prediction-section').style.display = 'none';
            
            uploadedFile = null;
            isDataFromUpload = false;
            
            showSuccessMessage('upload-status', '✅ Upload data cleared! Ready for new upload.');
        }

        // Enhanced switch tab function
        function switchTab(tab, element) {
            var tabs = document.getElementsByClassName('tab-btn');
            var sections = document.getElementsByClassName('section');
            
            for (var i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            for (var i = 0; i < sections.length; i++) {
                sections[i].classList.remove('active');
            }
            
            element.classList.add('active');
            
            if (tab === 'upload') {
                document.getElementById('upload-section').classList.add('active');
            } else if (tab === 'manual') {
                document.getElementById('manual-section').classList.add('active');
            }
        }

        // Trigger file upload
        function triggerFileUpload() {
            document.getElementById('file-input').click();
        }

        // Enhanced file upload handler
        function handleFileUpload(event) {
            var file = event.target.files[0];
            if (!file) return;

            clearUploadData();
            uploadedFile = file;
            
            var statusDiv = document.getElementById('upload-status');
            var previewDiv = document.getElementById('image-preview');
            var parsingDiv = document.getElementById('parsing-section');
            
            statusDiv.innerHTML = '<div class="loading">📤 Processing CP sheet... Please wait.</div>';

            // Show image preview for supported formats
            if (file.type.startsWith('image/')) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    previewDiv.innerHTML = '<h4>🖼️ Uploaded Image:</h4><img src="' + e.target.result + '" class="uploaded-image" alt="Uploaded CP Sheet">';
                };
                reader.readAsDataURL(file);
            }

            // Simulate OCR processing
            setTimeout(function() {
                parseUploadedFile(file);
            }, 2000);
        }

        // Enhanced file parsing with new data structure
        function parseUploadedFile(file) {
            var statusDiv = document.getElementById('upload-status');
            var parsingDiv = document.getElementById('parsing-section');
            
            parsingDiv.style.display = 'block';
            parsingDiv.innerHTML = '<h4>🔍 Extracting Data from CP Sheet...</h4><div class="loading">Processing with enhanced OCR...</div>';
            
            setTimeout(function() {
                var extractedData = simulateEnhancedOCRExtraction();
                
                parsingDiv.innerHTML = '<h4>📊 Extracted Data:</h4>' +
                    '<div class="data-extraction">' +
                    generateExtractionSummary(extractedData) +
                    '</div>' +
                    '<div style="margin-top: 15px;">' +
                    '<button type="button" class="btn" onclick="processExtractedData()" style="margin-right: 10px;">✅ Process This Data</button>' +
                    '<button type="button" class="btn btn-outline" onclick="showManualEditSection()">✏️ Edit Values Manually</button>' +
                    '</div>';
                
                window.extractedStudentData = extractedData;
                showSuccessMessage('upload-status', '✅ CP sheet processed! Review the extracted data below.');
            }, 1500);
        }

        // Generate extraction summary
        function generateExtractionSummary(data) {
            return 'Student Name: ' + data.name + '<br>' +
                'Admission No: ' + data.admissionNo + '<br>' +
                'Semester: ' + data.semester + '<br>' +
                'Overall Performance: ' + data.performance + '<br>' +
                'Courses Found: ' + data.courses.length + '<br><br>' +
                
                '<strong>Credit Hours:</strong><br>' +
                'Total Cr. Hrs: ' + data.totalCrHrs + '<br>' +
                'Priv. Cr.Hrs.: ' + data.privCrHrs + '<br>' +
                'Prey. Cr. Hr: ' + data.preyCrHrs + '<br>' +
                'Less Cr. Hr: ' + data.lessCrHrs + '<br>' +
                'Cumu. Cr. Hrs.: ' + data.cumuCrHrs + '<br><br>' +
                
                '<strong>Credit Points:</strong><br>' +
                'Total Cr. Pts.: ' + data.totalCrPts + '<br>' +
                'Priv. Cr.Pts.: ' + data.privCrPts + '<br>' +
                'Prey. Cr. Pts.: ' + data.preyCrPts + '<br>' +
                'Less Cr. Pts.: ' + data.lessCrPts + '<br>' +
                'Cumu. Cr. Pts.: ' + data.cumuCrPts + '<br><br>' +
                
                '<strong>Performance Metrics:</strong><br>' +
                'CPA: ' + data.cpa + '<br>' +
                'OCPA: ' + data.ocpa;
        }

        // Enhanced OCR simulation with all required fields
        function simulateEnhancedOCRExtraction() {
            return {
                name: 'DAVINDER SINGH',
                admissionNo: 'L-2015-A-18-D',
                semester: '17-18.1 (4)',
                performance: 'Good',
                
                courses: [
                    { code: 'EXT-571', title: 'Seminar', credits: 1, creditPoints: 7.5 },
                    { code: 'EXT-700', title: 'Ph.D. Research', credits: 16, creditPoints: 80.0 },
                    { code: 'EXT-700', title: 'Ph.D. Research (Cont.)', credits: 10, creditPoints: 0.0 }
                ],
                
                // Credit Hours
                totalCrHrs: 53,
                privCrHrs: 26,
                preyCrHrs: 27,
                lessCrHrs: 0,
                cumuCrHrs: 53,
                
                // Credit Points
                totalCrPts: 289.80,
                privCrPts: 202.30,
                preyCrPts: 87.50,
                lessCrPts: 0.00,
                cumuCrPts: 289.80,
                
                // Performance metrics
                cpa: 3.24,
                ocpa: 5.47
            };
        }

        // Show manual edit section for OCR corrections
        function showManualEditSection() {
            if (!window.extractedStudentData) {
                showErrorMessage('upload-status', '❌ No extracted data found!');
                return;
            }
            
            var data = window.extractedStudentData;
            var editSection = document.getElementById('manual-edit-section');
            
            editSection.style.display = 'block';
            editSection.innerHTML = '<div class="manual-edit-section">' +
                '<h4>✏️ Manually Edit Extracted Values</h4>' +
                '<p>Review and correct any values that were not extracted correctly:</p>' +
                
                '<div class="edit-grid">' +
                '<div class="form-group">' +
                '<label>Total Cr. Hrs</label>' +
                '<input type="number" id="edit-total-cr-hrs" value="' + data.totalCrHrs + '" step="0.5">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>Priv. Cr.Hrs.</label>' +
                '<input type="number" id="edit-priv-cr-hrs" value="' + data.privCrHrs + '" step="0.5">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>Prey. Cr. Hr</label>' +
                '<input type="number" id="edit-prey-cr-hrs" value="' + data.preyCrHrs + '" step="0.5">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>Less Cr. Hr</label>' +
                '<input type="number" id="edit-less-cr-hrs" value="' + data.lessCrHrs + '" step="0.5">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>Cumu. Cr. Hrs.</label>' +
                '<input type="number" id="edit-cumu-cr-hrs" value="' + data.cumuCrHrs + '" step="0.5">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>Total Cr. Pts.</label>' +
                '<input type="number" id="edit-total-cr-pts" value="' + data.totalCrPts + '" step="0.01">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>Priv. Cr.Pts.</label>' +
                '<input type="number" id="edit-priv-cr-pts" value="' + data.privCrPts + '" step="0.01">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>Prey. Cr. Pts.</label>' +
                '<input type="number" id="edit-prey-cr-pts" value="' + data.preyCrPts + '" step="0.01">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>Less Cr. Pts.</label>' +
                '<input type="number" id="edit-less-cr-pts" value="' + data.lessCrPts + '" step="0.01">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>Cumu. Cr. Pts.</label>' +
                '<input type="number" id="edit-cumu-cr-pts" value="' + data.cumuCrPts + '" step="0.01">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>CPA</label>' +
                '<input type="number" id="edit-cpa" value="' + data.cpa + '" step="0.01">' +
                '</div>' +
                
                '<div class="form-group">' +
                '<label>OCPA</label>' +
                '<input type="number" id="edit-ocpa" value="' + data.ocpa + '" step="0.01">' +
                '</div>' +
                '</div>' +
                
                '<div style="margin-top: 20px;">' +
                '<button type="button" class="btn" onclick="processEditedData()">✅ Process Edited Data</button>' +
                '<button type="button" class="btn btn-outline" onclick="hideManualEditSection()">❌ Cancel</button>' +
                '</div>' +
                '</div>';
        }

        // Hide manual edit section
        function hideManualEditSection() {
            document.getElementById('manual-edit-section').style.display = 'none';
        }

        // Process edited data
        function processEditedData() {
            var editedData = {
                name: window.extractedStudentData.name,
                admissionNo: window.extractedStudentData.admissionNo,
                semester: window.extractedStudentData.semester,
                performance: window.extractedStudentData.performance,
                courses: window.extractedStudentData.courses,
                
                totalCrHrs: parseFloat(document.getElementById('edit-total-cr-hrs').value) || 0,
                privCrHrs: parseFloat(document.getElementById('edit-priv-cr-hrs').value) || 0,
                preyCrHrs: parseFloat(document.getElementById('edit-prey-cr-hrs').value) || 0,
                lessCrHrs: parseFloat(document.getElementById('edit-less-cr-hrs').value) || 0,
                cumuCrHrs: parseFloat(document.getElementById('edit-cumu-cr-hrs').value) || 0,
                
                totalCrPts: parseFloat(document.getElementById('edit-total-cr-pts').value) || 0,
                privCrPts: parseFloat(document.getElementById('edit-priv-cr-pts').value) || 0,
                preyCrPts: parseFloat(document.getElementById('edit-prey-cr-pts').value) || 0,
                lessCrPts: parseFloat(document.getElementById('edit-less-cr-pts').value) || 0,
                cumuCrPts: parseFloat(document.getElementById('edit-cumu-cr-pts').value) || 0,
                
                cpa: parseFloat(document.getElementById('edit-cpa').value) || 0,
                ocpa: parseFloat(document.getElementById('edit-ocpa').value) || 0
            };
            
            updateStudentDataFromExtraction(editedData);
            displayResults();
            hideManualEditSection();
            
            showSuccessMessage('upload-status', '✅ Edited data processed successfully! Results displayed below.');
        }

        // Process extracted data directly
        function processExtractedData() {
            if (!window.extractedStudentData) {
                showErrorMessage('upload-status', '❌ No extracted data found!');
                return;
            }
            
            updateStudentDataFromExtraction(window.extractedStudentData);
            displayResults();
            showSuccessMessage('upload-status', '✅ Data processed successfully! Results displayed below.');
        }

        // Update student data from extraction
        function updateStudentDataFromExtraction(data) {
            studentData = {
                name: data.name,
                admissionNo: data.admissionNo,
                semester: data.semester,
                performance: data.performance,
                courses: data.courses,
                
                totalCrHrs: data.totalCrHrs,
                privCrHrs: data.privCrHrs,
                preyCrHrs: data.preyCrHrs,
                lessCrHrs: data.lessCrHrs,
                cumuCrHrs: data.cumuCrHrs,
                
                totalCrPts: data.totalCrPts,
                privCrPts: data.privCrPts,
                preyCrPts: data.preyCrPts,
                lessCrPts: data.lessCrPts,
                cumuCrPts: data.cumuCrPts,
                
                cpa: data.cpa,
                ocpa: data.ocpa
            };
            
            isDataFromUpload = true;
        }

        // Add new course row
        function addCourse() {
            var tbody = document.getElementById('courses-body');
            var rowCount = tbody.rows.length + 1;
            
            var row = tbody.insertRow();
            row.innerHTML = '<td>' + rowCount + '</td>' +
                '<td><input type="text" class="course-code" placeholder="EXT-XXX"></td>' +
                '<td><input type="text" class="course-title" placeholder="Course Title"></td>' +
                '<td><input type="number" class="course-credits" min="0.5" max="20" step="0.5" value="3" onchange="calculateFromCreditPoints()"></td>' +
                '<td><input type="number" class="course-cp" min="0" step="0.01" value="24.0" onchange="calculateFromCreditPoints()"></td>' +
                '<td><button type="button" class="btn btn-danger" onclick="removeCourse(this)">Remove</button></td>';
        }

        // Remove course row
        function removeCourse(button) {
            var row = button.closest('tr');
            var tbody = document.getElementById('courses-body');
            
            if (tbody.rows.length <= 1) {
                alert('⚠️ At least one course is required!');
                return;
            }
            
            row.remove();
            
            // Renumber rows
            var rows = tbody.rows;
            for (var i = 0; i < rows.length; i++) {
                rows[i].cells[0].textContent = i + 1;
            }
            
            calculateFromCreditPoints();
        }

        // Calculate from credit points (new formula implementation)
        function calculateFromCreditPoints() {
            // This function can be used to auto-calculate values as user types
            // Implementation depends on specific requirements
        }

        // Enhanced OCPA calculation with new formula
        function calculateOCPA() {
            var statusDiv = document.getElementById('manual-status');
            
            // Get basic info
            var name = document.getElementById('student-name').value.trim();
            var admissionNo = document.getElementById('admission-no').value.trim();
            var semester = document.getElementById('semester').value.trim();
            
            if (!name || !admissionNo || !semester) {
                showErrorMessage('manual-status', '❌ Please fill in all required fields (Name, Admission No, Semester)');
                return;
            }
            
            // Get all the new fields
            var totalCrHrs = parseFloat(document.getElementById('total-cr-hrs').value) || 0;
            var privCrHrs = parseFloat(document.getElementById('priv-cr-hrs').value) || 0;
            var preyCrHrs = parseFloat(document.getElementById('prey-cr-hrs').value) || 0;
            var lessCrHrs = parseFloat(document.getElementById('less-cr-hrs').value) || 0;
            var cumuCrHrs = parseFloat(document.getElementById('cumu-cr-hrs').value) || 0;
            
            var totalCrPts = parseFloat(document.getElementById('total-cr-pts').value) || 0;
            var privCrPts = parseFloat(document.getElementById('priv-cr-pts').value) || 0;
            var preyCrPts = parseFloat(document.getElementById('prey-cr-pts').value) || 0;
            var lessCrPts = parseFloat(document.getElementById('less-cr-pts').value) || 0;
            var cumuCrPts = parseFloat(document.getElementById('cumu-cr-pts').value) || 0;
            
            var performance = document.getElementById('performance').value;
            
            // Get courses
            var courses = [];
            var rows = document.getElementById('courses-body').rows;
            
            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var code = row.querySelector('.course-code').value.trim();
                var title = row.querySelector('.course-title').value.trim();
                var credits = parseFloat(row.querySelector('.course-credits').value) || 0;
                var creditPoints = parseFloat(row.querySelector('.course-cp').value) || 0;
                
                if (code && title && credits > 0) {
                    courses.push({ 
                        code: code, 
                        title: title, 
                        credits: credits, 
                        creditPoints: creditPoints 
                    });
                }
            }
            
            if (courses.length === 0) {
                showErrorMessage('manual-status', '❌ Please add at least one course with valid data');
                return;
            }
            
            // Calculate CPA using new formula
            var currentSemCrHrs = courses.reduce(function(sum, course) { return sum + course.credits; }, 0);
            var currentSemCrPts = courses.reduce(function(sum, course) { return sum + course.creditPoints; }, 0);
            var currentCPA = currentSemCrHrs > 0 ? currentSemCrPts / currentSemCrHrs : 0;
            
            // Calculate OCPA using new formula
            var totalCreditsForOCPA = privCrHrs + currentSemCrHrs;
            var totalPointsForOCPA = privCrPts + currentSemCrPts;
            var calculatedOCPA = totalCreditsForOCPA > 0 ? totalPointsForOCPA / totalCreditsForOCPA : 0;
            
            // Update student data
            studentData = {
                name: name,
                admissionNo: admissionNo,
                semester: semester,
                performance: performance,
                courses: courses,
                
                totalCrHrs: totalCrHrs,
                privCrHrs: privCrHrs,
                preyCrHrs: preyCrHrs,
                lessCrHrs: lessCrHrs,
                cumuCrHrs: cumuCrHrs,
                
                totalCrPts: totalCrPts,
                privCrPts: privCrPts,
                preyCrPts: preyCrPts,
                lessCrPts: lessCrPts,
                cumuCrPts: cumuCrPts,
                
                cpa: currentCPA,
                ocpa: calculatedOCPA
            };
            
            displayResults();
            showSuccessMessage('manual-status', '✅ OCPA calculated successfully using the new PAU formula!');
        }

        // Enhanced display results
        function displayResults() {
            // Update basic info
            document.getElementById('display-name').textContent = studentData.name;
            document.getElementById('display-admission').textContent = studentData.admissionNo;
            document.getElementById('display-semester').textContent = studentData.semester;
            document.getElementById('display-performance').textContent = studentData.performance;
            
            // Create results table
            var tableHTML = '<table class="course-table">' +
                '<thead><tr>' +
                '<th>Sr</th><th>Course Code</th><th>Course Title</th>' +
                '<th>Credit Hours</th><th>Credit Points</th>' +
                '</tr></thead><tbody>';
            
            for (var i = 0; i < studentData.courses.length; i++) {
                var course = studentData.courses[i];
                tableHTML += '<tr>' +
                    '<td>' + (i + 1) + '</td>' +
                    '<td>' + course.code + '</td>' +
                    '<td>' + course.title + '</td>' +
                    '<td>' + course.credits + '</td>' +
                    '<td>' + course.creditPoints.toFixed(2) + '</td>' +
                    '</tr>';
            }
            
            tableHTML += '</tbody></table>';
            document.getElementById('results-table').innerHTML = tableHTML;
            
            // Update all summary fields
            document.getElementById('display-total-cr-hrs').textContent = studentData.totalCrHrs;
            document.getElementById('display-priv-cr-hrs').textContent = studentData.privCrHrs;
            document.getElementById('display-prey-cr-hrs').textContent = studentData.preyCrHrs;
            document.getElementById('display-less-cr-hrs').textContent = studentData.lessCrHrs;
            document.getElementById('display-cumu-cr-hrs').textContent = studentData.cumuCrHrs;
            
            document.getElementById('display-total-cr-pts').textContent = studentData.totalCrPts.toFixed(2);
            document.getElementById('display-priv-cr-pts').textContent = studentData.privCrPts.toFixed(2);
            document.getElementById('display-prey-cr-pts').textContent = studentData.preyCrPts.toFixed(2);
            document.getElementById('display-less-cr-pts').textContent = studentData.lessCrPts.toFixed(2);
            document.getElementById('display-cumu-cr-pts').textContent = studentData.cumuCrPts.toFixed(2);
            
            document.getElementById('display-cpa').textContent = studentData.cpa.toFixed(2);
            document.getElementById('final-ocpa').textContent = studentData.ocpa.toFixed(2);
            
            // Show results section
            document.getElementById('results-section').style.display = 'block';
        }

        // Clear all data
        function clearData() {
            if (confirm('🗑️ Are you sure you want to clear all data?')) {
                // Reset form fields
                var formFields = [
                    'student-name', 'admission-no', 'semester', 
                    'total-cr-hrs', 'priv-cr-hrs', 'prey-cr-hrs', 'less-cr-hrs', 'cumu-cr-hrs',
                    'total-cr-pts', 'priv-cr-pts', 'prey-cr-pts', 'less-cr-pts', 'cumu-cr-pts'
                ];
                
                formFields.forEach(function(fieldId) {
                    var field = document.getElementById(fieldId);
                    if (field) field.value = fieldId.includes('cr-') ? '0' : '';
                });
                
                document.getElementById('performance').value = 'Good';
                
                // Reset courses table
                var tbody = document.getElementById('courses-body');
                tbody.innerHTML = '<tr>' +
                    '<td>1</td>' +
                    '<td><input type="text" class="course-code" placeholder="EXT-571"></td>' +
                    '<td><input type="text" class="course-title" placeholder="Course Title"></td>' +
                    '<td><input type="number" class="course-credits" min="0.5" max="20" step="0.5" value="3" onchange="calculateFromCreditPoints()"></td>' +
                    '<td><input type="number" class="course-cp" min="0" step="0.01" value="24.0" onchange="calculateFromCreditPoints()"></td>' +
                    '<td><button type="button" class="btn btn-danger" onclick="removeCourse(this)">Remove</button></td>' +
                    '</tr>';
                
                document.getElementById('manual-status').innerHTML = '';
                document.getElementById('results-section').style.display = 'none';
                document.getElementById('prediction-section').style.display = 'none';
                
                // Reset student data
                studentData = {
                    name: '', admissionNo: '', semester: '', performance: 'Good', courses: [],
                    totalCrHrs: 0, privCrHrs: 0, preyCrHrs: 0, lessCrHrs: 0, cumuCrHrs: 0,
                    totalCrPts: 0, privCrPts: 0, preyCrPts: 0, lessCrPts: 0, cumuCrPts: 0,
                    cpa: 0, ocpa: 0
                };
                
                alert('✅ All data cleared successfully!');
            }
        }

        // Show prediction section
        function showPrediction() {
            if (studentData.ocpa === 0) {
                alert('⚠️ Please calculate OCPA first!');
                return;
            }
            
            document.getElementById('results-section').style.display = 'none';
            document.getElementById('prediction-section').style.display = 'block';
            
            document.getElementById('pred-current-ocpa').textContent = studentData.ocpa.toFixed(2);
            calculatePrediction();
        }

        // Back to results
        function backToResults() {
            document.getElementById('prediction-section').style.display = 'none';
            document.getElementById('results-section').style.display = 'block';
        }

        // Add prediction course
        function addPrediction() {
            var tbody = document.getElementById('prediction-body');
            var row = tbody.insertRow();
            
            row.innerHTML = '<td><input type="text" placeholder="EXT-XXX"></td>' +
                '<td><input type="text" placeholder="Course Title"></td>' +
                '<td><input type="number" class="pred-credits" min="0.5" max="20" step="0.5" value="3" onchange="calculatePrediction()"></td>' +
                '<td><input type="number" class="pred-marks" min="0" max="100" value="75" onchange="calculatePrediction()"></td>' +
                '<td class="pred-cp">22.5</td>' +
                '<td><button type="button" class="btn btn-danger" onclick="removePrediction(this)">Remove</button></td>';
        }

        // Remove prediction course
        function removePrediction(button) {
            var tbody = document.getElementById('prediction-body');
            if (tbody.rows.length <= 1) {
                alert('⚠️ At least one course is required for prediction!');
                return;
            }
            
            button.closest('tr').remove();
            calculatePrediction();
        }

        // Convert marks percentage to credit points (PAU formula)
        function marksToCreditPoints(marks, credits) {
            // PAU Formula: Divide percentage by 10, then multiply by credit hours
            var gradePoints = marks / 10;
            return gradePoints * credits;
        }

        // Calculate prediction using new PAU formula
        function calculatePrediction() {
            var rows = document.getElementById('prediction-body').rows;
            var newCredits = 0;
            var newCP = 0;
            
            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var creditsInput = row.querySelector('.pred-credits');
                var marksInput = row.querySelector('.pred-marks');
                var cpCell = row.querySelector('.pred-cp');
                
                if (creditsInput && marksInput && cpCell) {
                    var credits = parseFloat(creditsInput.value) || 0;
                    var marks = parseFloat(marksInput.value) || 0;
                    var creditPoints = marksToCreditPoints(marks, credits);
                    
                    cpCell.textContent = creditPoints.toFixed(2);
                    
                    newCredits += credits;
                    newCP += creditPoints;
                }
            }
            
            // Calculate new CPA using PAU formula
            var newCPA = newCredits > 0 ? newCP / newCredits : 0;
            
            // Calculate projected OCPA using PAU formula
            var currentTotalCredits = studentData.privCrHrs + studentData.preyCrHrs;
            var currentTotalCP = studentData.privCrPts + studentData.preyCrPts;
            var projectedTotalCredits = currentTotalCredits + newCredits;
            var projectedTotalCP = currentTotalCP + newCP;
            var projectedOCPA = projectedTotalCredits > 0 ? projectedTotalCP / projectedTotalCredits : 0;
            
            // Update display
            document.getElementById('pred-new-credits').textContent = newCredits.toFixed(1);
            document.getElementById('pred-new-cp').textContent = newCP.toFixed(2);
            document.getElementById('pred-new-cpa').textContent = newCPA.toFixed(2);
            document.getElementById('projected-ocpa').textContent = projectedOCPA.toFixed(2);
        }

        // Enhanced export to HTML report
        function exportToHTML() {
            var content = generateEnhancedReportContent();
            var blob = new Blob([content], { type: 'text/html;charset=utf-8' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'PAU_OCPA_Report_' + studentData.admissionNo.replace(/[^a-zA-Z0-9]/g, '_') + '.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('📄 Enhanced report downloaded successfully!');
        }

        // Export to CSV
        function exportToCSV() {
            var csvContent = "PAU OCPA Report - Enhanced\n";
            csvContent += "Student Name," + studentData.name + "\n";
            csvContent += "Admission No," + studentData.admissionNo + "\n";
            csvContent += "Semester," + studentData.semester + "\n";
            csvContent += "Overall Performance," + studentData.performance + "\n\n";
            
            csvContent += "Credit Hours Summary\n";
            csvContent += "Total Cr. Hrs," + studentData.totalCrHrs + "\n";
            csvContent += "Priv. Cr.Hrs.," + studentData.privCrHrs + "\n";
            csvContent += "Prey. Cr. Hr," + studentData.preyCrHrs + "\n";
            csvContent += "Less Cr. Hr," + studentData.lessCrHrs + "\n";
            csvContent += "Cumu. Cr. Hrs.," + studentData.cumuCrHrs + "\n\n";
            
            csvContent += "Credit Points Summary\n";
            csvContent += "Total Cr. Pts.," + studentData.totalCrPts + "\n";
            csvContent += "Priv. Cr.Pts.," + studentData.privCrPts + "\n";
            csvContent += "Prey. Cr. Pts.," + studentData.preyCrPts + "\n";
            csvContent += "Less Cr. Pts.," + studentData.lessCrPts + "\n";
            csvContent += "Cumu. Cr. Pts.," + studentData.cumuCrPts + "\n\n";
            
            csvContent += "Course Details\n";
            csvContent += "Sr,Course Code,Course Title,Credit Hours,Credit Points\n";
            
            for (var i = 0; i < studentData.courses.length; i++) {
                var course = studentData.courses[i];
                csvContent += (i + 1) + ',"' + course.code + '","' + course.title + '",' + 
                    course.credits + ',' + course.creditPoints.toFixed(2) + '\n';
            }
            
            csvContent += "\nPerformance Summary\n";
            csvContent += "CPA," + studentData.cpa.toFixed(2) + "\n";
            csvContent += "OCPA," + studentData.ocpa.toFixed(2) + "\n";
            
            var blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'PAU_OCPA_Report_' + studentData.admissionNo.replace(/[^a-zA-Z0-9]/g, '_') + '.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('📊 Enhanced CSV report downloaded successfully!');
        }

        // Generate enhanced HTML report content
        function generateEnhancedReportContent() {
            return '<!DOCTYPE html>\n<html>\n<head>\n' +
                '<title>PAU OCPA Report - ' + studentData.admissionNo + '</title>\n' +
                '<style>\n' +
                'body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }\n' +
                '.header { background: linear-gradient(135deg, #2e7d32, #388e3c); color: white; padding: 25px; text-align: center; margin-bottom: 30px; border-radius: 8px; }\n' +
                '.info-box { background: #f0f7f0; padding: 20px; margin: 20px 0; border-left: 5px solid #2e7d32; border-radius: 5px; }\n' +
                '.summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }\n' +
                'table { width: 100%; border-collapse: collapse; margin: 20px 0; }\n' +
                'th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }\n' +
                'th { background: #2e7d32; color: white; }\n' +
                'tr:nth-child(even) { background: #f8f9fa; }\n' +
                '.performance-box { background: #e8f5e9; padding: 20px; margin: 20px 0; border-radius: 8px; text-align: center; }\n' +
                '.ocpa-highlight { font-size: 1.8em; font-weight: bold; color: #2e7d32; margin: 15px 0; }\n' +
                '.footer { text-align: center; margin-top: 40px; color: #666; font-size: 0.9em; }\n' +
                '</style>\n</head>\n<body>\n' +
                
                '<div class="header">\n<h1>🎓 PAU OCPA Report</h1>\n<p>Punjab Agricultural University - Enhanced Calculator</p>\n</div>\n' +
                
                '<div class="info-box">\n<h3>Student Information</h3>\n' +
                '<p><strong>Name:</strong> ' + studentData.name + '</p>\n' +
                '<p><strong>Admission Number:</strong> ' + studentData.admissionNo + '</p>\n' +
                '<p><strong>Semester:</strong> ' + studentData.semester + '</p>\n' +
                '<p><strong>Overall Performance:</strong> ' + studentData.performance + '</p>\n' +
                '<p><strong>Report Generated:</strong> ' + new Date().toLocaleDateString() + '</p>\n</div>\n' +
                
                '<div class="summary-grid">\n<div>\n<h4>📊 Credit Hours Summary</h4>\n' +
                '<p><strong>Total Cr. Hrs:</strong> ' + studentData.totalCrHrs + '</p>\n' +
                '<p><strong>Priv. Cr.Hrs.:</strong> ' + studentData.privCrHrs + '</p>\n' +
                '<p><strong>Prey. Cr. Hr:</strong> ' + studentData.preyCrHrs + '</p>\n' +
                '<p><strong>Less Cr. Hr:</strong> ' + studentData.lessCrHrs + '</p>\n' +
                '<p><strong>Cumu. Cr. Hrs.:</strong> ' + studentData.cumuCrHrs + '</p>\n</div>\n' +
                
                '<div>\n<h4>📈 Credit Points Summary</h4>\n' +
                '<p><strong>Total Cr. Pts.:</strong> ' + studentData.totalCrPts.toFixed(2) + '</p>\n' +
                '<p><strong>Priv. Cr.Pts.:</strong> ' + studentData.privCrPts.toFixed(2) + '</p>\n' +
                '<p><strong>Prey. Cr. Pts.:</strong> ' + studentData.preyCrPts.toFixed(2) + '</p>\n' +
                '<p><strong>Less Cr. Pts.:</strong> ' + studentData.lessCrPts.toFixed(2) + '</p>\n' +
                '<p><strong>Cumu. Cr. Pts.:</strong> ' + studentData.cumuCrPts.toFixed(2) + '</p>\n</div>\n</div>\n' +
                
                '<h3>📚 Course Details</h3>\n<table>\n<thead>\n<tr>\n' +
                '<th>Sr</th><th>Course Code</th><th>Course Title</th><th>Credit Hours</th><th>Credit Points</th>\n' +
                '</tr>\n</thead>\n<tbody>\n' +
                studentData.courses.map(function(course, index) {
                    return '<tr>\n<td>' + (index + 1) + '</td>\n<td>' + course.code + '</td>\n' +
                        '<td>' + course.title + '</td>\n<td>' + course.credits + '</td>\n' +
                        '<td>' + course.creditPoints.toFixed(2) + '</td>\n</tr>';
                }).join('\n') +
                '\n</tbody>\n</table>\n' +
                
                '<div class="performance-box">\n<h3>🏆 Academic Performance</h3>\n' +
                '<p><strong>Current Semester CPA:</strong> ' + studentData.cpa.toFixed(2) + '</p>\n' +
                '<div class="ocpa-highlight">\nOverall Cumulative Performance Average (OCPA): ' + studentData.ocpa.toFixed(2) + '\n</div>\n' +
                '<p><strong>Performance Grade:</strong> ' + studentData.performance + '</p>\n</div>\n' +
                
                '<div class="footer">\n<p><em>This report was generated by Enhanced PAU OCPA Calculator</em></p>\n' +
                '<p>Formula Used: CPA = Total Credit Points ÷ Total Credit Hours</p>\n' +
                '<p>OCPA = (Previous + Current Credit Points) ÷ (Previous + Current Credit Hours)</p>\n</div>\n</body>\n</html>';
        }

        // Utility functions for better UX
        function showSuccessMessage(containerId, message) {
            document.getElementById(containerId).innerHTML = '<div class="success-message">' + message + '</div>';
        }

        function showErrorMessage(containerId, message) {
            document.getElementById(containerId).innerHTML = '<div class="error-message">' + message + '</div>';
        }

        function showLoadingMessage(containerId, message) {
            document.getElementById(containerId).innerHTML = '<div class="loading">' + message + '</div>';
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ Enhanced PAU OCPA Calculator with new formula loaded successfully!');
            
            // Add some helpful tooltips or initial guidance
            var uploadSection = document.querySelector('.upload-section');
            if (uploadSection) {
                uploadSection.setAttribute('title', 'Upload your PAU Credit Point Sheet in JPG, PNG, or PDF format');
            }
        });

        // Additional helper function for percentage validation
        function validatePercentage(input) {
            var value = parseFloat(input.value);
            if (value > 100) {
                input.value = 100;
                alert('⚠️ Percentage cannot exceed 100%');
            } else if (value < 0) {
                input.value = 0;
                alert('⚠️ Percentage cannot be negative');
            }
        }

        // Auto-save functionality for manual entry (optional)
        function autoSaveData() {
            // This could be implemented to save data to localStorage
            // but as per instructions, we won't use localStorage
            console.log('Auto-save functionality ready (memory-based)');
        }
    </script>
</body>
</html>
